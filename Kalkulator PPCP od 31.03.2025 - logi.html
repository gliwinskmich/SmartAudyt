<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator dotacji Czyste Powietrze</title>

<!-- ========== style i skrypt w jednym pliku html z powodu zabezpieczeń traktujących *.js jako plik niebezpieczny ========== -->


    <style>
        *{
            padding-top: 5px;
        }
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            padding: 0 100px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ebeef2;
        }
        h1 {
            text-align: center;
            color: #5f8cba;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .input-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], select {
            padding: 8px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="checkbox"] {
            cursor: pointer;
        }
        select {
            cursor: pointer;
        }
        #heat-source-type {
            width: 550px;
        }
        .inline-input {
            display: inline-block;
            vertical-align: middle;
            margin-right: 5px;
        }
        .unit {
            display: inline-block;
            vertical-align: middle;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 0px;
            margin-right: 10px;
            height: 45px;
        }
        .buttons-container {
            margin-top: 20px;
        }
        .buttons-container p {
            position: fixed;
            bottom: 10px;
            right: 50px;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
            color: #8b8b8b;
            font-size: 20px;
            transition: 1s;
            cursor: default;
        }
        .buttons-container p:hover {
            color: #fff;
        }
        button:hover {
            background-color: #2980b9;
        }
        #clear-btn {
            background-color: #e64735;
        }
        #clear-btn:hover {
            background-color: #c0392b;
            color: #fff;
        }
        .error {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }
        .hidden {
            display: none;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #2ecc71;
            border-radius: 5px;
            background-color: #e8f8f0;
            font-size: 18px;
            font-weight: bold;
        }
        .note {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #3498db;
            border-radius: 5px;
            background-color: #d1edff;
            font-size: 14px;
            font-weight: bold;
            text-align: justify;
        }
        .error-message {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }

        .buttons-container {
            display: flex;
            justify-content: flex-start;
        }
    </style>
</head>
<body>

    <h1>Kalkulator dotacji Czyste Powietrze - od 31.03.2025</h1>
    
    <div class="section">
        <label for="funding-level">Wybierz poziom dofinansowania</label>
        <select id="funding-level">
            <option value="0" selected disabled hidden>Wybierz...</option>
            <option value="0.4">Podstawowy - do 40% kosztów netto</option>
            <option value="0.7">Podwyższony - do 70% kosztów netto</option>
            <option value="1">Najwyższy - do 100% kosztów netto</option>
        </select>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="business-activity"> W budynku lub lokalu prowadzona jest działalność gospodarcza</label>
        
        <div id="business-area-fields" class="hidden">
            <div class="input-group">
                <label>Podaj powierzchnię całkowitą budynku lub lokalu</label>
                <input type="number" id="total-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="total-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię przeznaczoną na prowadzenie działalności</label>
                <input type="number" id="business-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="business-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
            
            <div id="business-percentage" class="hidden"></div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="heat-source-change"> 
            Inwestycja obejmuje wymianę źródła ciepła
        </label>
        
        <div id="heat-source-fields" class="hidden">
            <label for="heat-source-type">Wybierz nowe źródło ciepła</label>
            <select id="heat-source-type">
                <option value="0"selected disabled hidden>Wybierz...</option>
                <option value="22250">Podłączenie do sieci ciepłowniczej wraz z przyłączem</option>
                <option value="31500">Pompa ciepła powietrze/woda (koszt kwalifikowany do 31.07.2025)</option>
                <option value="35200">Pompa ciepła powietrze/woda o podwyższonej klasie efektywności energetycznej</option>
                <option value="11200">Pompa ciepła powietrze/powietrze</option>
                <option value="45000">Gruntowa pompa ciepła o podwyższonej klasie efektywności energetycznej</option>
                <option value="20500">Kocioł zgazowujący drewno o podwyższonym standardzie</option>
                <option value="20500">Kocioł na pellet drzewny o podwyższonym standardzie</option>
                <option value="11200">Ogrzewanie elektryczne</option>
            </select>
            
            <div id="heat-source-cost-field" class="hidden input-group">
                <label>Podaj koszt źródła ciepła</label>
                <input type="number" id="heat-source-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="heat-source-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div id="additional-heat-source-field" class="hidden">
                <label>
                    <input type="checkbox" id="additional-heat-source"> 
                    Dodaj koszt dolnego źródła ciepła
                </label>
                
                <div id="additional-heat-source-cost-field" class="hidden input-group">
                    <label></label>
                    <input type="number" id="additional-heat-source-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                    <span class="unit">zł</span>
                    <div id="additional-heat-source-cost-error" class="error hidden">Podaj poprawną kwotę</div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="modernization-section" class="section hidden">
        <label>
            <input type="checkbox" id="modernization"> 
            Modernizacja instalacji c.o. lub c.w.u.
        </label>
        
        <div id="modernization-cost-field" class="hidden input-group">
            <label>Podaj koszt zadania</label>
            <input type="number" id="modernization-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
            <span class="unit">zł</span>
            <div id="modernization-cost-error" class="error hidden">Podaj poprawną kwotę</div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="roof-insulation"> 
            Ocieplenie stropów lub poddaszy
        </label>
        
        <div id="roof-insulation-fields" class="hidden">
            <div class="input-group">
                <label>Podaj koszt zadania</label>
                <input type="number" id="roof-insulation-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="roof-insulation-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię</label>
                <input type="number" id="roof-insulation-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="roof-insulation-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="floor-insulation"> 
            Ocieplenie podłóg
        </label>
        
        <div id="floor-insulation-fields" class="hidden">
            <div class="input-group">
                <label>Podaj koszt zadania</label>
                <input type="number" id="floor-insulation-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="floor-insulation-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię</label>
                <input type="number" id="floor-insulation-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="floor-insulation-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="wall-insulation"> 
            Ocieplenie ścian
        </label>
        
        <div id="wall-insulation-fields" class="hidden">
            <div class="input-group">
                <label>Podaj koszt zadania</label>
                <input type="number" id="wall-insulation-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="wall-insulation-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię</label>
                <input type="number" id="wall-insulation-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="wall-insulation-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="windows"> 
            Stolarka okienna
        </label>
        
        <div id="windows-fields" class="hidden">
            <div class="input-group">
                <label>Podaj koszt zadania</label>
                <input type="number" id="windows-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="windows-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię</label>
                <input type="number" id="windows-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="windows-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="doors"> 
            Stolarka drzwiowa
        </label>
        
        <div id="doors-fields" class="hidden">
            <div class="input-group">
                <label>Podaj koszt zadania</label>
                <input type="number" id="doors-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="doors-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię</label>
                <input type="number" id="doors-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="doors-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="garage-doors"> 
            Bramy garażowe
        </label>
        
        <div id="garage-doors-fields" class="hidden">
            <div class="input-group">
                <label>Podaj koszt zadania</label>
                <input type="number" id="garage-doors-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
                <span class="unit">zł</span>
                <div id="garage-doors-cost-error" class="error hidden">Podaj poprawną kwotę</div>
            </div>
            
            <div class="input-group">
                <label>Podaj powierzchnię</label>
                <input type="number" id="garage-doors-area" placeholder="Wpisz powierzchnię" min="0" step="0.01" class="inline-input">
                <span class="unit">m<sup>2</sup></span>
                <div id="garage-doors-area-error" class="error hidden">Podaj poprawną powierzchnię</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="ventilation"> 
            Wentylacja mechaniczna z odzyskiem ciepła
        </label>
        
        <div id="ventilation-cost-field" class="hidden input-group">
            <label>Podaj koszt zadania</label>
            <input type="number" id="ventilation-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
            <span class="unit">zł</span>
            <div id="ventilation-cost-error" class="error hidden">Podaj poprawną kwotę</div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="audit"> 
            Audyt energetyczny
        </label>
        
        <div id="audit-cost-field" class="hidden input-group">
            <label>Podaj koszt zadania</label>
            <input type="number" id="audit-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
            <span class="unit">zł</span>
            <div id="audit-cost-error" class="error hidden">Podaj poprawną kwotę</div>
        </div>
    </div>
    
    <div class="section">
        <label>
            <input type="checkbox" id="energy-certificate"> 
            Świadectwo charakterystyki energetycznej
        </label>
        
        <div id="energy-certificate-cost-field" class="hidden input-group">
            <label>Podaj koszt zadania</label>
            <input type="number" id="energy-certificate-cost" placeholder="Wpisz koszt netto" min="0" step="0.01" class="inline-input">
            <span class="unit">zł</span>
            <div id="energy-certificate-cost-error" class="error hidden">Podaj poprawną kwotę</div>
        </div>
    </div>
    
    
    <div id="error-message" class="error-message hidden"></div>
    <div id="result" class="result hidden"></div>
    <div id="note" class="note hidden"></div>

    <div class="buttons-container">
        <button id="calculate-btn">Oblicz dotację</button>
        <button id="clear-btn">Wyczyść formularz</button>
        <p>MG</p>
    </div>

    <script>

	// ---------------------------------------------------------------------------------------------\/ JS

        document.addEventListener('DOMContentLoaded', function() {

	// Poziom dofinansowania i działalność gospodarcza
            const fundingLevel = document.getElementById('funding-level');
            const businessActivity = document.getElementById('business-activity');
            const businessAreaFields = document.getElementById('business-area-fields'); 
            const totalArea = document.getElementById('total-area');
            const businessArea = document.getElementById('business-area');
            const businessPercentage = document.getElementById('business-percentage');
            const clearBtn = document.getElementById('clear-btn'); // Przycisk czyszczący
            
	// Źródło ciepła
            const heatSourceChange = document.getElementById('heat-source-change');
            const heatSourceFields = document.getElementById('heat-source-fields');
            const heatSourceType = document.getElementById('heat-source-type');
            const heatSourceCostField = document.getElementById('heat-source-cost-field');
            const heatSourceCost = document.getElementById('heat-source-cost');
            const additionalHeatSourceField = document.getElementById('additional-heat-source-field');
            const additionalHeatSource = document.getElementById('additional-heat-source');
            const additionalHeatSourceCostField = document.getElementById('additional-heat-source-cost-field');
            const additionalHeatSourceCost = document.getElementById('additional-heat-source-cost');
        
	// Instalacja c.o. c.w.u.    
            const modernizationSection = document.getElementById('modernization-section');
            const modernization = document.getElementById('modernization');
            const modernizationCostField = document.getElementById('modernization-cost-field');
            const modernizationCost = document.getElementById('modernization-cost');
            
	// Ocieplenie
		// Dach
            const roofInsulation = document.getElementById('roof-insulation');
            const roofInsulationFields = document.getElementById('roof-insulation-fields');
            const roofInsulationCost = document.getElementById('roof-insulation-cost');
            const roofInsulationArea = document.getElementById('roof-insulation-area');
		// Podłoga
            const floorInsulation = document.getElementById('floor-insulation');
            const floorInsulationFields = document.getElementById('floor-insulation-fields');
            const floorInsulationCost = document.getElementById('floor-insulation-cost');
            const floorInsulationArea = document.getElementById('floor-insulation-area');
            	// Ściany
            const wallInsulation = document.getElementById('wall-insulation');
            const wallInsulationFields = document.getElementById('wall-insulation-fields');
            const wallInsulationCost = document.getElementById('wall-insulation-cost');
            const wallInsulationArea = document.getElementById('wall-insulation-area');
	
	// Okna
            const windows = document.getElementById('windows');
            const windowsFields = document.getElementById('windows-fields');
            const windowsCost = document.getElementById('windows-cost');
            const windowsArea = document.getElementById('windows-area');
            
	// Drzwi
            const doors = document.getElementById('doors');
            const doorsFields = document.getElementById('doors-fields');
            const doorsCost = document.getElementById('doors-cost');
            const doorsArea = document.getElementById('doors-area');
            
	// Brama
            const garageDoors = document.getElementById('garage-doors');
            const garageDoorsFields = document.getElementById('garage-doors-fields');
            const garageDoorsCost = document.getElementById('garage-doors-cost');
            const garageDoorsArea = document.getElementById('garage-doors-area');
            
	// Rekuperacja
            const ventilation = document.getElementById('ventilation');
            const ventilationCostField = document.getElementById('ventilation-cost-field');
            const ventilationCost = document.getElementById('ventilation-cost');
            const ventilationArea = 1.0;
            
	// Audyt
            const audit = document.getElementById('audit');
            const auditCostField = document.getElementById('audit-cost-field');
            const auditCost = document.getElementById('audit-cost');
            
	// Świadectwo
            const energyCertificate = document.getElementById('energy-certificate');
            const energyCertificateCostField = document.getElementById('energy-certificate-cost-field');
            const energyCertificateCost = document.getElementById('energy-certificate-cost');
	
	// Przycisk i reakcja
            const calculateBtn = document.getElementById('calculate-btn');
            const resultDiv = document.getElementById('result');
            const note = document.getElementById('note');
            const errorMessageDiv = document.getElementById('error-message');
            
	// Obsługa zdarzeń
            businessActivity.addEventListener('change', function() {
                businessAreaFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    totalArea.value = '';
                    businessArea.value = '';
                    businessPercentage.classList.add('hidden');
                }
            });

            function clearForm() {
		
		console.clear();

	// Reset póla formularza (działalność, źródło, instalacja)
                fundingLevel.value = '0';
                
                businessActivity.checked = false;
                businessAreaFields.classList.add('hidden');
                totalArea.value = '';
                businessArea.value = '';
                businessPercentage.classList.add('hidden');
                
                heatSourceChange.checked = false;
                heatSourceFields.classList.add('hidden');
                heatSourceType.value = '0';
                heatSourceCostField.classList.add('hidden');
                heatSourceCost.value = '';
                additionalHeatSourceField.classList.add('hidden');
                additionalHeatSource.checked = false;
                additionalHeatSourceCostField.classList.add('hidden');
                additionalHeatSourceCost.value = '';
                
                modernizationSection.classList.add('hidden');
                modernization.checked = false;
                modernizationCostField.classList.add('hidden');
                modernizationCost.value = '';
                
	// Reset pól dla ociepleń i stolarki
                const areaBasedFields = [
                    { checkbox: roofInsulation, fields: roofInsulationFields, cost: roofInsulationCost, area: roofInsulationArea },
                    { checkbox: floorInsulation, fields: floorInsulationFields, cost: floorInsulationCost, area: floorInsulationArea },
                    { checkbox: wallInsulation, fields: wallInsulationFields, cost: wallInsulationCost, area: wallInsulationArea },
                    { checkbox: windows, fields: windowsFields, cost: windowsCost, area: windowsArea },
                    { checkbox: doors, fields: doorsFields, cost: doorsCost, area: doorsArea },
                    { checkbox: garageDoors, fields: garageDoorsFields, cost: garageDoorsCost, area: garageDoorsArea }
                ];
                
                areaBasedFields.forEach(field => {
                    field.checkbox.checked = false;
                    field.fields.classList.add('hidden');
                    field.cost.value = '';
                    field.area.value = '';
                });
                
	// Resetowanie pozostałych pól
                ventilation.checked = false;
                ventilationCostField.classList.add('hidden');
                ventilationCost.value = '';
                
                audit.checked = false;
                auditCostField.classList.add('hidden');
                auditCost.value = '';
                
                energyCertificate.checked = false;
                energyCertificateCostField.classList.add('hidden');
                energyCertificateCost.value = '';
                
	// Ukrywanie komunikatów o błędach <-- do ewentualnego dodania funkcja badająca zmiany w polach typu number na żywo (komunikat o błędzie nie znika po zmianie wartości na prawidłową do momentu wykonania obliczeń)
                document.querySelectorAll('.error').forEach(el => el.classList.add('hidden'));
                errorMessageDiv.classList.add('hidden');
                resultDiv.classList.add('hidden');
                note.classList.add('hidden');

	// Funkcja opóźniająca scroll-up z powodu konfliktu funkcji w niektórych przeglądarkach
                setTimeout(() => {
                window.scrollTo( {
                        top: 0,
                        behavior: 'smooth'
                    });
               }, 50);
            }
            
            
	// Przycisk resetu
            clearBtn.addEventListener('click', clearForm);
            
            
            heatSourceChange.addEventListener('change', function() {
                heatSourceFields.classList.toggle('hidden', !this.checked);
                modernizationSection.classList.toggle('hidden', !this.checked);
                
               	// --------------------------------------------------- pozostałość po innej implementacji - niech na razie zostanie ---- 
		   // if (!this.checked) {   
                   // heatSourceType.value = '0';
                   // heatSourceCostField.classList.add('hidden');
                   // heatSourceCost.value = '';
                   // additionalHeatSourceField.classList.add('hidden');
                   // additionalHeatSource.checked = false;
                   // additionalHeatSourceCostField.classList.add('hidden');
                   // additionalHeatSourceCost.value = '';
                   // modernization.checked = false;
                   // modernizationCostField.classList.add('hidden');
                   // modernizationCost.value = '';
               // }
            });
            
            heatSourceType.addEventListener('change', function() {
                const selectedValue = this.value;
                heatSourceCostField.classList.toggle('hidden', selectedValue === '0');
                additionalHeatSourceField.classList.toggle('hidden', selectedValue !== '45000');
                
                if (selectedValue === '0') {
                    heatSourceCost.value = '';
                    modernizationSection.classList.add('hidden');
                    modernization.checked = false;
                    modernizationCostField.classList.add('hidden');
                    modernizationCost.value = '';
                } else {
                    modernizationSection.classList.remove('hidden');
                }
                
                if (selectedValue !== '45000') {
                    additionalHeatSource.checked = false;
                    additionalHeatSourceCostField.classList.add('hidden');
                    additionalHeatSourceCost.value = '';
                }
            });
            
            additionalHeatSource.addEventListener('change', function() {
                additionalHeatSourceCostField.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    additionalHeatSourceCost.value = '';
                }
            });
            
            // Obsługa zdarzeń dla pozostałych checkboxów
            modernization.addEventListener('change', function() {
                modernizationCostField.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    modernizationCost.value = '';
                }
            });
            
            roofInsulation.addEventListener('change', function() {
                roofInsulationFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    roofInsulationCost.value = '';
                    roofInsulationArea.value = '';
                }
            });
            
            floorInsulation.addEventListener('change', function() {
                floorInsulationFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    floorInsulationCost.value = '';
                    floorInsulationArea.value = '';
                }
            });
            
            wallInsulation.addEventListener('change', function() {
                wallInsulationFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    wallInsulationCost.value = '';
                    wallInsulationArea.value = '';
                }
            });
            
            windows.addEventListener('change', function() {
                windowsFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    windowsCost.value = '';
                    windowsArea.value = '';
                }
            });
            
            doors.addEventListener('change', function() {
                doorsFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    doorsCost.value = '';
                    doorsArea.value = '';
                }
            });
            
            garageDoors.addEventListener('change', function() {
                garageDoorsFields.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    garageDoorsCost.value = '';
                    garageDoorsArea.value = '';
                }
            });
            
            ventilation.addEventListener('change', function() {
                ventilationCostField.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    ventilationCost.value = '';
                }
            });
            
            audit.addEventListener('change', function() {
                auditCostField.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    auditCost.value = '';
                }
            });
            
            energyCertificate.addEventListener('change', function() {
                energyCertificateCostField.classList.toggle('hidden', !this.checked);
                if (!this.checked) {
                    energyCertificateCost.value = '';
                }
            });
            
            // Obsługa zmian w polach powierzchni dla działalności gospodarczej
            totalArea.addEventListener('input', calculateBusinessPercentage);
            businessArea.addEventListener('input', calculateBusinessPercentage);
            
            function calculateBusinessPercentage() {
                const total = parseFloat(totalArea.value);
                const business = parseFloat(businessArea.value);
                
                if (isNaN(total) || isNaN(business)) {
                    businessPercentage.classList.add('hidden');
                    return;
                }
                
                if (business > total) {
                    businessArea.innerHTML('Powierzchnia działalności nie może być większa niż powierzchnia całkowita');
                    businessPercentage.classList.add('hidden');
                    return;
                } else {
                    businessArea.setCustomValidity('');
                }
                
                const percentage = (business / total) * 100;
                businessPercentage.classList.remove('hidden');
                
                if (percentage <= 30) {
                    businessPercentage.innerHTML = `Działalność gospodarcza stanowi ${percentage.toFixed(2)}% powierzchni całkowitej budynku`;
                    businessPercentage.style.color = '';
                } else {
                    businessPercentage.innerHTML = `<span style="color: red;">Powierzchnia działalności przekracza 30% powierzchni całkowitej budynku, dotacja nie może zostać przyznana</span>`;
                }
            }
            
            // Walidacja
            function validateForm() {
                let isValid = true;
                errorMessageDiv.classList.add('hidden');
                errorMessageDiv.textContent = '';
                
                // Sprawdź poziom dofinansowania
                if (fundingLevel.value === '0') {
                    isValid = false;
                    errorMessageDiv.textContent += 'Wybierz poziom dofinansowania.\n';
                }
                
                // Sprawdź pola działalności gospodarczej
                if (businessActivity.checked) {
                    if (!totalArea.value || parseFloat(totalArea.value) <= 0) {
                        isValid = false;
                        document.getElementById('total-area-error').classList.remove('hidden');
                        errorMessageDiv.textContent += 'Podaj poprawną powierzchnię całkowitą budynku.\n';
                    } else {
                        document.getElementById('total-area-error').classList.add('hidden');
                    }
                    
                    if (!businessArea.value || parseFloat(businessArea.value) <= 0) {
                        isValid = false;
                        document.getElementById('business-area-error').classList.remove('hidden');
                        errorMessageDiv.textContent += 'Podaj poprawną powierzchnię działalności.\n';
                    } else {
                        document.getElementById('business-area-error').classList.add('hidden');
                    }
                    
                    if (parseFloat(businessArea.value) > parseFloat(totalArea.value)) {
                        isValid = false;
                        errorMessageDiv.textContent += 'Powierzchnia działalności nie może być większa niż powierzchnia całkowita.\n';
                    }
                }
                
                if (heatSourceChange.checked) {
                    if (heatSourceType.value === '0') {
                        isValid = false;
                        errorMessageDiv.textContent += 'Wybierz nowe źródło ciepła.\n';
                    }
                    
                    if (!heatSourceCost.value || parseFloat(heatSourceCost.value) < 0) {
                        isValid = false;
                        document.getElementById('heat-source-cost-error').classList.remove('hidden');
                        errorMessageDiv.textContent += 'Podaj poprawny koszt źródła ciepła.\n';
                    } else {
                        document.getElementById('heat-source-cost-error').classList.add('hidden');
                    }
                    
                    if (additionalHeatSource.checked && (!additionalHeatSourceCost.value || parseFloat(additionalHeatSourceCost.value) < 0)) {
                        isValid = false;
                        document.getElementById('additional-heat-source-cost-error').classList.remove('hidden');
                        errorMessageDiv.textContent += 'Podaj poprawny koszt dolnego źródła ciepła.\n';
                    } else {
                        document.getElementById('additional-heat-source-cost-error').classList.add('hidden');
                        document.getElementById('modernization-section').classList.remove('hidden');
                    }
                }
                
                if (modernization.checked && (!modernizationCost.value || parseFloat(modernizationCost.value) < 0)) {
                    isValid = false;
                    document.getElementById('modernization-cost-error').classList.remove('hidden');
                    errorMessageDiv.textContent += 'Podaj poprawny koszt modernizacji instalacji.\n';
                } else {
                    document.getElementById('modernization-cost-error').classList.add('hidden');
                }
                
                const checkFields = [
                    { checkbox: roofInsulation, cost: roofInsulationCost, area: roofInsulationArea, costError: 'roof-insulation-cost-error', areaError: 'roof-insulation-area-error', name: 'ocieplenia stropów' },
                    { checkbox: floorInsulation, cost: floorInsulationCost, area: floorInsulationArea, costError: 'floor-insulation-cost-error', areaError: 'floor-insulation-area-error', name: 'ocieplenia podłóg' },
                    { checkbox: wallInsulation, cost: wallInsulationCost, area: wallInsulationArea, costError: 'wall-insulation-cost-error', areaError: 'wall-insulation-area-error', name: 'ocieplenia ścian' },
                    { checkbox: windows, cost: windowsCost, area: windowsArea, costError: 'windows-cost-error', areaError: 'windows-area-error', name: 'stolarki okiennej' },
                    { checkbox: doors, cost: doorsCost, area: doorsArea, costError: 'doors-cost-error', areaError: 'doors-area-error', name: 'stolarki drzwiowej' },
                    { checkbox: garageDoors, cost: garageDoorsCost, area: garageDoorsArea, costError: 'garage-doors-cost-error', areaError: 'garage-doors-area-error', name: 'bram garażowych' }
                ];
                
                checkFields.forEach(field => {
                    if (field.checkbox.checked) {
                        if (!field.cost.value || parseFloat(field.cost.value) < 0) {
                            isValid = false;
                            document.getElementById(field.costError).classList.remove('hidden');
                            errorMessageDiv.textContent += `Podaj poprawny koszt ${field.name}.\n`;
                        } else {
                            document.getElementById(field.costError).classList.add('hidden');
                        }
                        
                        if (!field.area.value || parseFloat(field.area.value) <= 0) {
                            isValid = false;
                            document.getElementById(field.areaError).classList.remove('hidden');
                            errorMessageDiv.textContent += `Podaj poprawną powierzchnię ${field.name}.\n`;
                        } else {
                            document.getElementById(field.areaError).classList.add('hidden');
                        }
                    }
                });
                
                const simpleCheckFields = [
                    { checkbox: ventilation, cost: ventilationCost, costError: 'ventilation-cost-error', name: 'wentylacji' },
                    { checkbox: audit, cost: auditCost, costError: 'audit-cost-error', name: 'audytu' },
                    { checkbox: energyCertificate, cost: energyCertificateCost, costError: 'energy-certificate-cost-error', name: 'świadectwa energetycznego' }
                ];
                
                simpleCheckFields.forEach(field => {
                    if (field.checkbox.checked && (!field.cost.value || parseFloat(field.cost.value) < 0)) {
                        isValid = false;
                        document.getElementById(field.costError).classList.remove('hidden');
                        errorMessageDiv.textContent += `Podaj poprawny koszt ${field.name}.\n`;
                    } else {
                        document.getElementById(field.costError).classList.add('hidden');
                    }
                });
                
                if (!isValid) {
                    errorMessageDiv.classList.remove('hidden');
                }
                
                return isValid;
            }
            
            // Funkcja obliczająca dotację

            function calculateGrant() {
                
                if (!validateForm()) {
                    resultDiv.classList.add('hidden');
                    
                    return;
                }

               
                // Maksymalne koszty dla poszczególnych kategorii
                const maxCosts = {
                    heatSource: {
                        '22250': 22250, // Podłączenie do sieci ciepłowniczej wraz z przyłączem
                        '31500': 31500, // Pompa ciepła powietrze/woda
                        '35200': 35200, // Pompa ciepła powietrze/woda o podwyższonej klasie efektywności energetycznej
                        '11200': 11200, // Pompa ciepła powietrze/powietrze
                        '45000': 45000, // Gruntowa pompa ciepła (bez dolnego źródła)
                        '20500': 20500 // Kotły na paliwo stałe o obniżonej emisyjności (pellet i zgazowujący drewno)
                    },
                    additionalHeatSource: 20000, // Dolne źródło ciepła do gruntowej pomy ciepła
                    modernization: 20500, // c.o c.w.u.
                    roofInsulation: 200, // dach - 1m^2
                    floorInsulation: 150, // podłoga - 1m^2
                    wallInsulation: 250, // ściana - 1m^2
                    windows: 1200, // okna - 1m^2
                    doors: 2500, // drzwi - 1m^2
                    garageDoors: 1500, // brama - 1m^2
                    ventilation: 16700, // wentylacja
                    audit: 1200, // audyt
                    energyCertificate: 400 // świadectwo
                };
                
                let totalCost = 0;
                
                // Obliczenie kosztu źródła ciepła
                if (heatSourceChange.checked) {
                    const selectedHeatSource = heatSourceType.value;
                    const userHeatSourceCost = parseFloat(heatSourceCost.value);
                    const maxHeatSourceCost = maxCosts.heatSource[selectedHeatSource] || 0;
                    
                    totalCost += Math.min(userHeatSourceCost, maxHeatSourceCost);
                    console.log("Koszt kwalifikowany źródła ciepła: " + Math.min(userHeatSourceCost, maxHeatSourceCost) + " zł");
                    // Dodaj koszt dolnego źródła ciepła jeśli zaznaczono gruntową pompę ciepła
                    if (additionalHeatSource.checked) {
                        const userAdditionalCost = parseFloat(additionalHeatSourceCost.value);
                        totalCost += Math.min(userAdditionalCost, maxCosts.additionalHeatSource);
			console.log("Koszt kwalifikowany dolnego źródło ciepła: " + Math.min(userAdditionalCost, maxCosts.additionalHeatSource) + " zł");
                    }
                }
                
                // Obliczenie kosztu modernizacji instalacji
                if (modernization.checked) {
                    const userModernizationCost = parseFloat(modernizationCost.value);
                    totalCost += Math.min(userModernizationCost, maxCosts.modernization);
			console.log("Koszt kwalifikowany instalacji c.o. lub c.w.u.: " + Math.min(userModernizationCost, maxCosts.modernization) + " zł");
                }
                
                // Obliczenie kosztyu pozostałych kategorii
                const areaBasedFields = [
                    { checkbox: roofInsulation, cost: roofInsulationCost, area: roofInsulationArea, max: maxCosts.roofInsulation },
                    { checkbox: floorInsulation, cost: floorInsulationCost, area: floorInsulationArea, max: maxCosts.floorInsulation },
                    { checkbox: wallInsulation, cost: wallInsulationCost, area: wallInsulationArea, max: maxCosts.wallInsulation },
                    { checkbox: windows, cost: windowsCost, area: windowsArea, max: maxCosts.windows },
                    { checkbox: doors, cost: doorsCost, area: doorsArea, max: maxCosts.doors },
                    { checkbox: garageDoors, cost: garageDoorsCost, area: garageDoorsArea, max: maxCosts.garageDoors },
                ];
                
                let areaBasedTotal = 0;
                
                areaBasedFields.forEach(field => {
                    if (field.checkbox.checked) {
                        const userCost = parseFloat(field.cost.value);
                        const area = parseFloat(field.area.value);
                        const maxCostPerM2 = field.max;
                        
                        areaBasedTotal += Math.min(userCost, maxCostPerM2 * area);
			console.log(" >> podany cząstkowy koszt termomodernizacji (ocieplenie lub stolarka): " + Math.min(userCost, maxCostPerM2 * area) + " zł");
                    }
                });

                if (ventilation.checked) {
                    const userCost = parseFloat(ventilationCost.value);

                    areaBasedTotal += Math.min(userCost, maxCosts.ventilation);
			console.log(" >> podany cząstkowy koszt termomodernizacji (wentylacja mechaniczna): " + Math.min(userCost, maxCosts.ventilation) + " zł");
                }
                
                // Ograniczenie sumy kosztów termo do 83000 zł
                totalCost += Math.min((areaBasedTotal), 83000);

		console.log("Koszt kwalifikowany termomodernizacji (suma cząstkowych kosztów termomodernizacji, max. 83000 zł): " + Math.min((areaBasedTotal), 83000) + " zł");
                
                // Dodanie pozostałych kosztyów
                if (audit.checked) {
                    const userCost = parseFloat(auditCost.value);
                    totalCost += Math.min(userCost, maxCosts.audit);
			console.log("Koszt kwalifikowany audytu: " + Math.min(userCost, maxCosts.audit) + " zł");
                }
                
                if (energyCertificate.checked) {
                    const userCost = parseFloat(energyCertificateCost.value);
                    totalCost += Math.min(userCost, energyCertificateCost.value);
			console.log("Koszt kwalifikowany świadectwa energetycznego: " + Math.min(userCost, energyCertificateCost.value) + " zł");
                }
                
                // Uwzględnienie poziomu dofinansowania
                const fundingRate = parseFloat(fundingLevel.value);
                let grantAmount = totalCost * fundingRate;
			console.log("Mnożnik ze względu na poziom dofinansowania: " + fundingLevel.value);
                
                // Uwzględnienie działalności gospodarczej
                if (businessActivity.checked) {
                    const total = parseFloat(totalArea.value);
                    const business = parseFloat(businessArea.value);
                    const businessPercentage = business / total;
			console.log("Mnożnik ze względu na działalność gospodarczą: " + (1 - businessPercentage));
                    
                    // Warunek czy działalność nie przekracza 30%
                    if (businessPercentage > 0.3) {
                        resultDiv.classList.add('hidden');
                        errorMessageDiv.textContent = 'Powierzchnia działalności przekracza 30% powierzchni całkowitej budynku, dotacja nie może zostać przyznana';
                        errorMessageDiv.classList.remove('hidden');
                        return;
			console.log("Dotacja nie będzie przyznana -> powierzchnia działalności przekracza 30% powierzchni budynku");
                    }
                    
                    grantAmount *= (1 - businessPercentage);
                }
                
                // Wyświetl wynik
                resultDiv.classList.remove('hidden');
                resultDiv.textContent = `Możliwa dotacja do kwoty: ${grantAmount.toFixed(2)} zł`;
                errorMessageDiv.classList.add('hidden');
                note.classList.remove('hidden');
                note.textContent = 'v0.1 For details check console (F12)';
			console.log("Dopuszczalna końcowa kwota dofinansowania: " + grantAmount.toFixed(2) + " zł");
                
                // Funkcja opóźniająca scroll-down z powodu konfliktu funkcji w niektórych przeglądarkach 
                setTimeout(() => {
                window.scrollTo( {
                        top: document.body.scrollHeight,
                        behavior: 'smooth'
                    });
               }, 50);
            }
            
            // Przypisanie funkcji liczącej do przycisku            
            calculateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                calculateGrant();
            });

        });
    </script>
</body>
</html>